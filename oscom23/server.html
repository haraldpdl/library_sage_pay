<h1>Sage Pay Server</h1>

<p>Sage Pay Server is recommended if you wish to run your own order and transaction reports, but you do not want to collect credit card details on your website. To use this product your website must have a fixed IP address.&nbsp; The hosted Sage Pay payment pages work within an iframe on your website giving you the look and feel of a direct integration but without the PCI Compliance requirements as no card data is ever Stored, Processed or Transmitted from the merchant's website.</p>

<h3>How It Works</h3>

{image}server.jpg{image}
{image}server_content.jpg{image}

<h3>Features And Benefits</h3>

<ul>
  <li>Simple integration</li>
  <li>Complete security using the Sage Pay payment pages</li>
  <li>Customisable payment pages</li>
  <li>iFrame solution</li>
  <li>Flexible payment features</li>
  <li>Automate transaction requests</li>
  <li>Run your own order and transaction reports</li>
</ul>

<p>The Sage Pay Server payment module is included in osCommerce Online Merchant v2.2 and is available as a separate add-on for existing store owners who are running earlier versions of osCommerce Online Merchant v2.2.</p>

<div class="note">This payment module requires PHP to support cURL or access to the "curl" program file.</div>

<div class="achtung">Existing osCommerce Online Merchant v2.2 Milestone 2 store owners must perform additional changes to core source code files to install and use this payment module. These changes are described in the "Manual Installation (as an Add-On)" section.</div>

<h2>Configuration Settings</h2>

<table class="pretty">
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Enable Sage Pay Server Module</td>
      <td>Setting this parameter to <em>True</em> makes the payment method available to customers during the checkout procedure.</td>
    </tr>
    <tr>
      <td>Vendor Login Name</td>
      <td>The vendor login name used to connect to the transaction gateway with.</td>
    </tr>
    <tr>
      <td>Profile Payment Page</td>
      <td>
        Profile page to use for the payment page.

        <dl>
          <dt>Normal</dt>
          <dd>Redirect the customer to the payment page hosted at Sage Pay.</dd>

          <dt>Low</dt>
          <dd>Load the Sage Pay payment page through an iframe in the checkout procedure.</dd>
        </dl>
      </td>
    </tr>
    <tr>
      <td>Transaction Method</td>
      <td>
        The following transaction methods are available to process transactions with:

        <dl>
          <dt>Authenticate</dt>
          <dd>The <em>Authenticate</em> transaction method only verifies the card and card holder using the 3D-Secure mechanism provided by the card-schemes and card issuing banks. Authorisations and Settlements of transactions are performed manually on the My Sage Pay Admin interface.</dd>

          <dt>Deferred</dt>
          <dd>The <em>Deferred</em> transaction method verifies and authorises the transaction and is captured manually on the My Sage Pay Admin Interface.</dd>

          <dt>Payment</dt>
          <dd>The <em>Payment</em> transaction method verifies, authorises, and transfers the funds to your Merchant account via batch settlement.</dd>
        </dl>
      </td>
    </tr>
    <tr>
      <td>Transaction Server</td>
      <td>
        The following transaction servers are available to process transactions through:

        <dl>
          <dt>Live</dt>
          <dd>The <em>Live</em> server is used in production environments to process and receive payments from customers.</dd>

          <dt>Test</dt>
          <dd>The <em>Test</em> server is only used to test transactions on the Production server. No transactions are processed and no payments are made when transactions are being tested.</dd>

          <dt>Simulator</dt>
          <dd>The <em>Simulator</em> server is used to test transactions in a sandbox testing environment. No transactions are processed and no payments are made within this environment.</dd>
        </dl>
      </td>
    </tr>
    <tr>
      <td>Payment Zone</td>
      <td>If set, this payment method will only be available to orders made within the defined zone.</td>
    </tr>
    <tr>
      <td>Set Order Status</td>
      <td>The orders status will be updated to this value when a successful transaction has been made.</td>
    </tr>
    <tr>
      <td>Sort Order</td>
      <td>The position to show the payment method on the checkout payment page against other available payment methods.</td>
    </tr>
    <tr>
      <td>cURL Location</td>
      <td>The location and filename of the cURL "curl" program file.</td>
    </tr>
  </tbody>
</table>

<h2>Manual Installation (as an Add-On)</h2>

<p>After extracting the add-on package, copy the files located in the <em>catalog</em> directory to your osCommerce installation directory on the server. The files must be copied in the correct directory structure as extracted from the add-on package.</p>

<p>The file listing is as follows:</p>

<ul>
  <li>ext/modules/payment/sage_pay/checkout.php</li>
  <li>ext/modules/payment/sage_pay/errors.php</li>
  <li>ext/modules/payment/sage_pay/redirect.php</li>
  <li>includes/languages/english/modules/payment/sage_pay_server.php</li>
  <li>includes/languages/espanol/modules/payment/sage_pay_server.php</li>
  <li>includes/languages/german/modules/payment/sage_pay_server.php</li>
  <li>includes/modules/payment/sage_pay_server.php</li>
</ul>

<p>The standard languages definitions in English, Spanish, and German are provided in the add-on package. For additional languages, copy one of the existing language definition files to the appropriate language directory and edit the file with a text editor to edit the language definitions. The location of the language definition file must be in:</p>

<ul>
  <li>includes/languages/<em>language</em>/modules/payment/sage_pay_server.php</li>
</ul>

<p>When the files have been copied to their appropriate locations, the payment module will be available in the Administration Tool -> Modules -> Payment Modules listing where it can be installed.</p>

<h3>Additional Changes for Existing osCommerce Online Merchant v2.2 Milestone 2 Store Owners</h3>

<p>The following core source code changes must also be performed for osCommerce Online Merchant v2.2 Milestone 2 installations:</p>

<p><a href="http://github.com/osCommerce/oscommerce2/commit/80fb06c35704b1c9a8160bc7f7345cc91145862a" target="_blank">http://github.com/osCommerce/oscommerce2/commit/80fb06c35704b1c9a8160bc7f7345cc91145862a</a></p>

<p>This change has been made as a bugfix for osCommerce Online Merchant v2.2 Release Candidate 1 (released 4th July 2007).</p>

<h2>Changelog</h2>

<dl class="bulleted">
  <dt>v1.2 07-Sep-2012</dt>
  <dd>Fixed generated URLs (tep_href_link() produces &amp;amp; in URLs which need to be replaced with & in the payment module)</dd>

  <dt>v1.1 01-Sep-2009</dt>
  <dd>Fixed Live/Production Transaction Server parameter value to "Live".</dd>
  <dd>Added "SWITCH" to the verification of the "CardType" parameter (this was not noted in the API documentation)</dd>

  <dt>v1.0 28-Aug-2009</dt>
  <dd>Initial Release</dd>
</dl>

<h2>Upgrade Notes</h2>

<h3>v1.1 to v1.2</h3>

<p>If you are upgrading from v1.1 to v1.2 of the payment module, please copy and overwrite the following files on your server:</p>

<ul>
  <li>includes/modules/payment/sage_pay_server.php</li>
</ul>

<h3>v1.0 to v1.1</h3>

<p>If you are upgrading from v1.0 to v1.1 of the payment module, please copy and overwrite the following files on your server:</p>

<ul>
  <li>includes/modules/payment/sage_pay_server.php</li>
</ul>

<p>To update the "Transaction Server" parameter, either remove and re-install the module from the Administration Tool -> Modules -> Payment Modules page, or perform the following SQL query to your database:</p>

{code}update configuration set set_function = 'tep_cfg_select_option(array(\'Live\', \'Test\', \'Simulator\'), ' where configuration_key = 'MODULE_PAYMENT_SAGE_PAY_SERVER_TRANSACTION_SERVER';{code}
